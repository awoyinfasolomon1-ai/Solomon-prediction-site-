<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>XOSOLOMON - 0.15s AI Delay (Background Music Only)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    margin: 0;
    padding: 20px;
    animation: backgroundColorChange 10s infinite alternate;
  }
  @keyframes backgroundColorChange {
    0% { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
    100% { background: linear-gradient(135deg, #fddb92 0%, #d1fdff 100%); }
  }
  h1 {
    margin-bottom: 10px;
    color: #fff;
    text-shadow: 2px 2px 4px #000;
  }
  #nameInputContainer, #levelSelectionContainer {
    margin-bottom: 15px;
  }
  input[type="text"] {
    padding: 8px;
    font-size: 1em;
    width: 200px;
    border-radius: 10px;
    border: 2px solid #fff;
  }
  #levelLadder {
    margin: 20px 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .level-btn {
    padding: 8px 12px;
    margin: 4px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    /* Default button gradient */
    background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); 
    color: #fff;
    box-shadow: 0 0 10px #fff inset, 0 0 20px #f6d365;
    transition: all 0.3s ease;
  }
  .level-btn.highlight {
     /* Highlight for current level */
    background: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%) !important;
    color: #333; /* Darker text for brighter highlight */
  }
  .level-btn.locked {
    background: #555 !important; /* Override background for locked */
    cursor: not-allowed;
    opacity: 0.6;
    box-shadow: none;
  }
  #game {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    gap: 10px;
    justify-content: center;
    margin: 20px auto;
  }
  .cell {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    font-size: 2em;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 12px;
    box-shadow: 0 0 10px #fff inset, 0 0 20px #f093fb;
    transition: all 0.3s ease;
  }
  #status {
    margin-top: 20px;
    font-size: 1.2em;
    color: #fff;
    text-shadow: 2px 2px 4px #000;
  }
  #topButtons {
    margin-bottom: 20px;
    display: block; 
  }
  button {
    margin: 0 10px;
    padding: 10px 20px;
    font-size: 1em;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    color: #fff;
    box-shadow: 0 0 10px #fff inset, 0 0 20px #66a6ff;
    cursor: pointer;
  }
  button:hover:not(:disabled) {
    transform: scale(1.05);
  }
  /* STYLE FOR SPEAKER BUTTON */
  #muteToggle {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(255, 255, 255, 0.2); 
    color: #fff;
    font-size: 1.5em;
    padding: 10px;
    border-radius: 50%; 
    width: 40px;
    height: 40px;
    line-height: 20px;
    text-align: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    cursor: pointer;
    z-index: 100; 
  }
</style>
</head>
<body>

<div id="muteToggle" title="Toggle Music">ðŸ”Š</div>

<h1>XOSOLOMON</h1>

<div id="topButtons">
  <button id="viewLadderBtn">View Level Selection</button>
</div>

<div id="nameInputContainer">
  <label for="playerName">Enter Your Name: </label>
  <input type="text" id="playerName" placeholder="Your name" />
  <button id="nameSubmitBtn">Submit</button>
</div>

<div id="levelSelectionContainer" style="display:none;">
  <h3>Select Your Level</h3>
  <div id="levelLadder"></div>
</div>

<div id="game" style="display:none;"></div>
<div id="status"></div>
<button id="restartBtn" style="display:none;">Restart Level</button>

<script>
/* --- Configuration --- */
const AI_MOVE_DELAY = 150; // 0.15 seconds

/* --- Sounds (Background Music Only) --- */
const backgroundMusic = new Audio('sounds/background.mp3'); // Ensure this file is in your 'sounds' folder
backgroundMusic.loop = true;
backgroundMusic.volume = 0.6; 
let isMuted = false;

const muteToggleButton = document.getElementById('muteToggle');

// Define sound effects - ALL REMOVED/SILENCED.
function playSound(sound) {
  // This function now does nothing, effectively silencing all game actions.
  // We keep it so the rest of the code doesn't break.
  return; 
}

/* --- Mute Toggle Logic (ONLY for Background Music) --- */
muteToggleButton.addEventListener('click', () => {
    isMuted = !isMuted; // Toggle mute state
    
    // NO button sound played here.
    
    if (isMuted) {
        backgroundMusic.pause(); // Pause background music
        muteToggleButton.textContent = 'ðŸ”‡'; // Show muted icon
        muteToggleButton.title = 'Unmute Music';
    } else {
        // Attempt to play music. This user click satisfies browser rules.
        backgroundMusic.play().catch(e => {
            console.log("Music play failed on unmute:", e);
        });
        muteToggleButton.textContent = 'ðŸ”Š'; // Show unmuted icon
        muteToggleButton.title = 'Toggle Music';
    }
});


/* --- Elements & State --- */
const levelLadderDiv = document.getElementById('levelLadder');
const nameInput = document.getElementById('playerName');
const nameSubmitBtn = document.getElementById('nameSubmitBtn');
const nameInputContainer = document.getElementById('nameInputContainer');
const levelSelectionContainer = document.getElementById('levelSelectionContainer');
const gameContainer = document.getElementById('game');
const statusDiv = document.getElementById('status');
const restartBtn = document.getElementById('restartBtn');
const viewLadderBtn = document.getElementById('viewLadderBtn'); 

let board = [
  ['', '', ''],
  ['', '', ''],
  ['', '', '']
];

const human = 'O';
const ai = 'X';

let gameActive = false;
let currentLevel = 1;
let playerName = '';

const maxLevel = 50;
let unlockedLevels = [];

/* --- Initialization & Local Storage --- */

// Load from storage
if (localStorage.getItem('unlockedLevels')) {
  unlockedLevels = JSON.parse(localStorage.getItem('unlockedLevels')).map(Number);
} else {
  unlockedLevels = [1];
  localStorage.setItem('unlockedLevels', JSON.stringify(unlockedLevels));
}
const storedName = localStorage.getItem('playerName');
const lastLevel = localStorage.getItem('lastLevel');

if (storedName) {
  playerName = storedName;
  document.getElementById('nameInputContainer').style.display = 'none';
  document.getElementById('levelSelectionContainer').style.display = 'block';
  currentLevel = lastLevel ? parseInt(lastLevel) : 1;
  generateLevelButtons();
  updateLevelHighlights();
  statusDiv.textContent = `Welcome back, ${playerName}! Select a level to continue.`;
}

/* --- UI Functions (Level Selection) --- */

// Generate clickable level buttons on the main screen
function generateLevelButtons() {
  levelLadderDiv.innerHTML = '';
  for (let lvl = 1; lvl <= maxLevel; lvl++) {
    const btn = document.createElement('button');
    btn.className = 'level-btn';
    btn.textContent = `Level ${lvl}`;
    btn.dataset.level = lvl;

    if (!unlockedLevels.includes(lvl)) {
      btn.classList.add('locked');
      btn.disabled = true;
    } else {
      btn.addEventListener('click', (e) => {
        playSound(null); // Will do nothing (silenced button click)
        currentLevel = parseInt(e.target.dataset.level);
        updateLevelHighlights();
        startGame();
      });
    }

    levelLadderDiv.appendChild(btn);
  }
  updateLevelHighlights();
}

// Update the visual highlight for the current level
function updateLevelHighlights() {
  const allBtns = levelLadderDiv.querySelectorAll('.level-btn');
  allBtns.forEach(btn => {
    btn.classList.remove('highlight');
    if (parseInt(btn.dataset.level) === currentLevel) {
      btn.classList.add('highlight');
    }
  });
}

// Function to display level selection (the ladder)
function showLevelSelection() {
    if (!playerName) {
        playSound(null); // Will do nothing (silenced error sound)
        statusDiv.textContent = "Please enter your name first, Solomon!";
        return;
    }
    playSound(null); // Will do nothing (silenced button click)
    document.getElementById('game').style.display = 'none';
    document.getElementById('restartBtn').style.display = 'none';
    document.getElementById('levelSelectionContainer').style.display = 'block';
    statusDiv.textContent = `Player: ${playerName}. Select a level to play.`;
    generateLevelButtons();
}

/* --- Event Listeners --- */

document.getElementById('nameSubmitBtn').addEventListener('click', () => {
  const name = nameInput.value.trim();
  if (!name) {
    playSound(null); // Will do nothing (silenced error sound)
    alert('Please enter your name, Solomon!');
    return;
  }
  playSound(null); // Will do nothing (silenced button click)
  playerName = name;
  localStorage.setItem('playerName', playerName);
  localStorage.setItem('lastLevel', 1);
  currentLevel = 1;
  document.getElementById('nameInputContainer').style.display = 'none';
  document.getElementById('levelSelectionContainer').style.display = 'block';
  generateLevelButtons();
  statusDiv.textContent = `Welcome, ${playerName}! Please select a level to start.`;
});

// Listener for the "View Level Selection" button
document.getElementById('viewLadderBtn').addEventListener('click', showLevelSelection);

document.getElementById('restartBtn').addEventListener('click', () => {
  playSound(null); // Will do nothing (silenced button click)
  restartLevel();
});

/* --- Game Flow Functions --- */

// Start game
function startGame() {
  playSound(null); // Will do nothing (silenced level start sound)
  document.getElementById('nameInputContainer').style.display = 'none';
  document.getElementById('levelSelectionContainer').style.display = 'none';
  document.getElementById('game').style.display = 'grid';
  document.getElementById('restartBtn').style.display = 'inline-block';
  localStorage.setItem('lastLevel', currentLevel);
  statusDiv.textContent = `Starting Level ${currentLevel}. Your turn, ${playerName}!`;
  init();
}

// Initialize game
function init() {
  gameContainer.innerHTML = '';
  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.index = i;
    cell.addEventListener('click', handleCellClick);
    gameContainer.appendChild(cell);
  }
  board = [
    ['', '', ''],
    ['', '', ''],
    ['', '', '']
  ];
  statusDiv.textContent = `Your turn, ${playerName}!`;
  gameActive = true;
}

// Handle player's move
function handleCellClick(e) {
  const index = e.target.dataset.index;
  const row = Math.floor(index / 3);
  const col = index % 3;

  if (!gameActive || board[row][col] !== '') {
    playSound(null); // Will do nothing (silenced error sound)
    return;
  }
  
  makeMove(row, col, human);
  playSound(null); // Will do nothing (silenced move sound)

  if (checkWin(board, human)) {
    statusDiv.textContent = `Congratulations ${playerName}, you win Level ${currentLevel}! ðŸŽ‰`;
    playSound(null); // Will do nothing (silenced win sound)
    gameActive = false;
    setTimeout(() => {
      unlockNextLevel();
    }, 1500);
    return;
  } else if (isBoardFull(board)) {
    statusDiv.textContent = `Level ${currentLevel}: It's a draw! ðŸ¤ Restarting...`;
    playSound(null); // Will do nothing (silenced draw sound)
    gameActive = false;
    setTimeout(() => {
      restartLevel(); // Auto-restart on Draw
    }, 1500);
    return;
  }
  
  // AI move
  statusDiv.textContent = "Computer's turn...";
  setTimeout(() => {
    let move = getAIMove(board);
    
    if (move) {
      makeMove(move.row, move.col, ai);
      playSound(null); // Will do nothing (silenced move sound)
      
      if (checkWin(board, ai)) {
        statusDiv.textContent = `Computer wins Level ${currentLevel}! ðŸ¤– Restarting...`;
        playSound(null); // Will do nothing (silenced lose sound)
        gameActive = false;
        setTimeout(() => {
          restartLevel(); // Auto-restart on Loss
        }, 1500);
      } else if (isBoardFull(board)) {
        statusDiv.textContent = `Level ${currentLevel}: It's a draw! ðŸ¤ Restarting...`;
        playSound(null); // Will do nothing (silenced draw sound)
        gameActive = false;
        setTimeout(() => {
          restartLevel(); // Auto-restart on Draw
        }, 1500);
      } else {
        statusDiv.textContent = `Your turn, ${playerName}!`;
      }
    }
  }, AI_MOVE_DELAY); // <-- The AI speed is set here to 150ms!
}

// Unlock next level after win
function unlockNextLevel() {
  const nextLevel = currentLevel + 1;
  let unlockedNewLevel = false;

  if (currentLevel < maxLevel && !unlockedLevels.includes(nextLevel)) {
    playSound(null); // Will do nothing (silenced unlock sound)
    unlockedLevels.push(nextLevel);
    unlockedLevels.sort((a, b) => a - b);
    localStorage.setItem('unlockedLevels', JSON.stringify(unlockedLevels));
    unlockedNewLevel = true;
  }

  if (currentLevel < maxLevel) {
    currentLevel = nextLevel;
  }
  localStorage.setItem('lastLevel', currentLevel);
  
  generateLevelButtons(); 

  // LOGIC: Auto-start the next level
  if (currentLevel <= maxLevel) {
      const message = unlockedNewLevel 
          ? `New level unlocked! Level ${currentLevel} selected. Starting in 1 second...`
          : `Level ${currentLevel} selected. Starting in 1 second...`;
          
      statusDiv.textContent = message;
      document.getElementById('levelSelectionContainer').style.display = 'none'; 
      document.getElementById('game').style.display = 'grid'; 
      
      setTimeout(() => {
          startGame();
      }, 1000);
  } else {
      statusDiv.textContent = `You have beaten all ${maxLevel} levels, ${playerName}!`;
      // Return to level selection if all levels are beaten
      document.getElementById('game').style.display = 'none';
      document.getElementById('restartBtn').style.display = 'none';
      document.getElementById('levelSelectionContainer').style.display = 'block';
  }
}

// Restart current level
function restartLevel() {
  statusDiv.textContent = `Level ${currentLevel} restarted. Good luck, ${playerName}!`;
  setTimeout(startGame, 500);
}

// Make move (UI update)
function makeMove(row, col, player) {
  board[row][col] = player;
  const index = row * 3 + col;
  document.querySelector(`.cell[data-index='${index}']`).textContent = player;
}

/* --- AI Logic (Difficulty Scaling) --- */
function checkWin(bd, player) {
  for (let i = 0; i < 3; i++) {
    if (bd[i][0] === player && bd[i][1] === player && bd[i][2] === player) return true;
    if (bd[0][i] === player && bd[1][i] === player && bd[2][i] === player) return true;
  }
  if (bd[0][0] === player && bd[1][1] === player && bd[2][2] === player) return true;
  if (bd[0][2] === player && bd[1][1] === player && bd[2][0] === player) return true;
  return false;
}
function isBoardFull(bd) {
  return bd.flat().every(cell => cell !== '');
}
function getAvailableMoves(bd) {
  const moves = [];
  for (let r = 0; r < 3; r++) {
    for (let c = 0; c < 3; c++) {
      if (bd[r][c] === '') {
        moves.push({row: r, col: c});
      }
    }
  }
  return moves;
}
function getRandomMove(bd) {
  const moves = getAvailableMoves(bd);
  if (moves.length === 0) return null;
  return moves[Math.floor(Math.random() * moves.length)];
}

function getAIMove(bd) {
    if (currentLevel >= 15) {
        return getBestMove(bd);
    } else if (currentLevel >= 5) {
        const minimaxChance = 0.5 + (currentLevel - 5) * 0.05; 
        if (Math.random() < minimaxChance) {
            return getBestMove(bd);
        } else {
            return getRandomMove(bd);
        }
    } else {
        return getRandomMove(bd);
    }
}

function getBestMove(bd) {
  let bestScore = -Infinity;
  let move = null;
  for (const m of getAvailableMoves(bd)) {
    bd[m.row][m.col] = ai;
    const score = minimax(bd, 0, false);
    bd[m.row][m.col] = '';
    if (score > bestScore) {
      bestScore = score;
      move = m;
    }
  }
  return move;
}
function minimax(bd, depth, isMax) {
  if (checkWin(bd, ai)) return 10 - depth;
  if (checkWin(bd, human)) return depth - 10;
  if (isBoardFull(bd)) return 0;
  if (isMax) {
    let maxEval = -Infinity;
    for (const m of getAvailableMoves(bd)) {
      bd[m.row][m.col] = ai;
      const evalScore = minimax(bd, depth + 1, false);
      bd[m.row][m.col] = ''; 
      maxEval = Math.max(maxEval, evalScore);
    }
    return maxEval;
  } else {
    let minEval = Infinity;
    for (const m of getAvailableMoves(bd)) {
      bd[m.row][m.col] = human;
      const evalScore = minimax(bd, depth + 1, true);
      bd[m.row][m.col] = '';
      minEval = Math.min(minEval, evalScore);
    }
    return minEval;
  }
}
// Re-call generateLevelButtons if the page loaded with a stored name
if(playerName) {
    generateLevelButtons();
}
</script>

</body>
</html>
